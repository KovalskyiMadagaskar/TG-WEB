<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Telegram Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! ‚ú®</h2>

    <div class="menu" id="menuButtons">
        <button class="menu-button" onclick="startAction('deposit')">üí∞ –ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
        <button class="menu-button" onclick="startAction('withdraw')">üí∏ –í—ã–≤–µ—Å—Ç–∏</button>
        <button class="menu-button" onclick="goToProfile()">üë§ –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</button>
    </div>

    <div class="input-section" id="amountSection">
        <input type="number" id="amountInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –≤ ‚Ç∏" />
        <br>
        <button class="confirm-button" onclick="confirmAmount()">–î–∞–ª–µ–µ</button>
    </div>

    <div class="method-section" id="methodSection">
        <h3>–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–±</h3>
        <button class="method-button" onclick="submitWithMethod('kaspi')">–ö–∞—Å–ø–∏</button>
        <button class="method-button" onclick="submitWithMethod('card')">–ö–∞—Ä—Ç–∞ –¥—Ä—É–≥–æ–≥–æ –±–∞–Ω–∫–∞</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // –ü–æ–ª—É—á–∞–µ–º club_id –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ URL
        const urlParams = new URLSearchParams(window.location.search);
        const clubId = urlParams.get("club_id");

        let currentAction = "";
        let currentAmount = 0;

        function startAction(action) {
            currentAction = action;
            currentAmount = 0;
            document.getElementById("menuButtons").style.display = "none";
            document.getElementById("amountSection").style.display = "block";
            document.getElementById("methodSection").style.display = "none";
        }

        function confirmAmount() {
            const input = document.getElementById("amountInput");
            const amount = parseFloat(input.value);
            if (!amount || amount <= 0) {
                tg.showAlert("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É –≤ —Ç–µ–Ω–≥–µ");
                return;
            }
            currentAmount = amount;
            document.getElementById("amountSection").style.display = "none";
            document.getElementById("methodSection").style.display = "block";
        }

        function goToProfile() {
            const clubId = urlParams.get("club_id");
            window.location.href = `profile.html?club_id=${clubId}`;
        }

        function submitWithMethod(method) {
            const data = {
                club_id: clubId,
                action: currentAction,
                amount: currentAmount,
                method: method,
                currency: "KZT"
            };
            tg.sendData(JSON.stringify(data));

            const methodText = method === 'kaspi' ? '–ö–∞—Å–ø–∏' : '–∫–∞—Ä—Ç—É –¥—Ä—É–≥–æ–≥–æ –±–∞–Ω–∫–∞';
            const actionText = currentAction === 'deposit' ? '–ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ' : '–≤—ã–≤–æ–¥';

            tg.showAlert(
                `–í—ã –≤—ã–±—Ä–∞–ª–∏ ${actionText} –Ω–∞ ${currentAmount}‚Ç∏ —á–µ—Ä–µ–∑ ${methodText}\nID –∫–ª—É–±–∞: ${clubId}`
            );
        }

        function handleAction(action) {
            tg.showAlert(`–í—ã –≤—ã–±—Ä–∞–ª–∏ "${action === 'profile' ? '–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç' : action}"`);
        }
    </script>
</body>
</html>
